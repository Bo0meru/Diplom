{% extends "home/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/questions.css' %}">
{% endblock %}
{% block extra_js %}
<script src="{% static 'js/questions.js' %}"></script>
{% endblock %}
{% block content %}
<div class="content-container">
    <!-- –ë–ª–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ -->
    <div class="questions-container">
        <h2>–ë–∞–Ω–∫ –≤–æ–ø—Ä–æ—Å–æ–≤</h2>
        <div class="search-bar">
            <input type="text" id="search-bar" placeholder="üîç –ü–æ–∏—Å–∫">
            <a href="{% url 'create_question' %}" class="create-question-button">–°–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</a>
        </div>
        <div class="question-list">
            {% for question in questions %}
            <div class="question-item" data-tags="{% for tag in question.tags.all %}{{ tag.id }} {% endfor %}{% if not question.tags.exists %}none{% endif %}">
                <a href="{% url 'edit_question' question.pk %}">
                    <h3>–í–æ–ø—Ä–æ—Å ‚Ññ{{ forloop.counter }}</h3>
                    <p>{{ question.text }}</p>
                    <ul>
                        {% for answer in question.answers.all %}
                        <li class="{% if answer.correct %}correct{% else %}incorrect{% endif %}">
                            {{ answer.text }}
                        </li>
                        {% endfor %}
                    </ul>
                </a>
            </div>
            {% empty %}
            <p>–í–æ–ø—Ä–æ—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
            {% endfor %}
        </div>
    </div>

    <!-- –ë–ª–æ–∫ –º–µ—Ç–æ–∫ -->
    <div class="tags-container">
        <div class="tags-header">
            <h2>–ú–µ—Ç–∫–∏</h2>
            <div class="tags-search-bar-container">
                <input
                    type="text"
                    id="tags-search-bar"
                    class="tags-search-bar"
                    placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –º–µ—Ç–∫–∞–º..."
                />
                <button id="clear-tags" class="clear-tags-button">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
        </div>
        <div id="tags-grid" class="tags-grid">
            <!-- –ú–µ—Ç–∫–∞ "–ë–µ–∑ –º–µ—Ç–∫–∏" -->
            <div class="tag-item">
                <label>
                    <input type="checkbox" name="tag_none" id="tag_none">
                    –ë–µ–∑ –º–µ—Ç–∫–∏
                </label>
            </div>
            {% for tag in all_tags %}
            <div class="tag-item">
                <label>
                    <input type="checkbox" name="tag_{{ tag.id }}" id="tag_{{ tag.id }}">
                    {{ tag.name }}
                </label>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
    const searchBar = document.getElementById("tags-search-bar");
    if (searchBar) {
        searchBar.addEventListener("input", function () {
            const searchQuery = this.value.toLowerCase();
            const tags = document.querySelectorAll(".tags-grid .tag-item");

            tags.forEach(tag => {
                const tagText = tag.innerText.toLowerCase();
                tag.style.display = tagText.includes(searchQuery) ? "block" : "none";
            });
        });
    }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const tagCheckboxes = document.querySelectorAll(".tag-item input[type='checkbox']");
    const clearTagsButton = document.getElementById("clear-tags");

    function clearAllTags() {
        tagCheckboxes.forEach(checkbox => {
            checkbox.checked = false; // –°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ
        });
        filterQuestions(); // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—á–∏—Å—Ç–∫–∏
    if (clearTagsButton) {
        clearTagsButton.addEventListener("click", clearAllTags);
    }

    // –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ (–æ—Å—Ç–∞–ª–∞—Å—å –∫–∞–∫ –≤ –ø—Ä–æ—à–ª–æ–º –∫–æ–¥–µ)
    function filterQuestions() {
        const selectedTags = Array.from(tagCheckboxes)
            .filter(checkbox => checkbox.checked)
            .map(checkbox => checkbox.id.replace("tag_", ""));

        const questions = document.querySelectorAll(".question-item");
        questions.forEach(question => {
            const questionTags = question.getAttribute("data-tags").trim().split(/\s+/);
            const hasMatch = selectedTags.includes("none") && questionTags.includes("none") ||
                             selectedTags.some(tag => questionTags.includes(tag));

            const isVisible = selectedTags.length === 0 || hasMatch;
            question.style.display = isVisible ? "block" : "none";
        });
    }

    tagCheckboxes.forEach(checkbox => {
        checkbox.addEventListener("change", filterQuestions);
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    filterQuestions();
});

</script>
{% endblock %}
