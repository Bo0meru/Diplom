{% extends "home/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/edit_question.css' %}">
{% endblock %}

{% block content %}
<div class="edit-question-container">
    <form method="post" id="edit-question-form">
        {% csrf_token %}
        <h2>Редактирование вопроса</h2>

        <!-- Текст вопроса -->
        <div class="question-text">
            <label for="question-text" class="editable-label">Вопрос:</label>
            <span class="editable-text" contenteditable="true" id="question-text">{{ question.text }}</span>
            <input type="hidden" name="question_text" id="hidden-question-text" value="{{ question.text }}">
        </div>

        <!-- Варианты ответов -->
        <h3>Варианты ответов</h3>
        <div class="answer-container">
            {% for answer in answers %}
            <div class="answer-item">
                <span class="editable-text answer-text" contenteditable="true" data-answer-id="{{ answer.id }}">
                    {{ answer.text }}
                </span>
                <input type="hidden" name="answer_text_{{ answer.id }}" id="hidden-answer-text-{{ answer.id }}" value="{{ answer.text }}">
                <label class="correct-label">
                    <input type="checkbox" name="answer_correct_{{ answer.id }}" id="answer-correct-{{ answer.id }}" {% if answer.correct %}checked{% endif %}>
                    Верный
                </label>
            </div>
            {% endfor %}
        </div>

        <!-- Блок тегов -->
        <div class="tags-container">
            <h3>Метки документа</h3>
            <div class="tags-grid">
                {% for tag in all_tags %}
                <div class="tag-item">
                    <label>
                        <input type="checkbox" name="tag_{{ tag.id }}" id="tag-{{ tag.id }}" {% if tag in question.tags.all %}checked{% endif %}>
                        {{ tag.name }}
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Кнопки -->
        <div class="buttons-container">
            <button type="submit" class="btn-save">Сохранить</button>
            <button type="button" class="btn-cancel" onclick="window.history.back();">Отмена</button>
        </div>
    </form>
</div>

<script>
    document.getElementById('edit-question-form').addEventListener('submit', function (event) {
        // Передача текста вопроса в скрытое поле
        document.getElementById('hidden-question-text').value = document.getElementById('question-text').innerText;

        // Передача текста вариантов ответов в скрытые поля
        document.querySelectorAll('.answer-text').forEach(function (element) {
            const answerId = element.getAttribute('data-answer-id');
            document.getElementById(`hidden-answer-text-${answerId}`).value = element.innerText;
        });
    });
</script>
{% endblock %}
